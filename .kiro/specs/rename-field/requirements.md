# Техническое задание: Переименование поля `last_modified` в `updated_at`

**Статус:** `Draft`
**Дата:** `2025-09-28`
**Автор:** `Gemini`

## 1. Цель

Основной целью данной задачи является унификация полей, отвечающих за хранение времени последнего обновления данных в системе. Необходимо переименовать поле `last_modified` в `updated_at` для ряда таблиц в базе данных, чтобы обеспечить консистентность именования со всей схемой (например, с таблицами `users` и `comments`, которые уже используют `updated_at`).

Это изменение устранит путаницу и упростит дальнейшую разработку и поддержку кода.

## 2. Затрагиваемые компоненты

Изменение затронет следующие компоненты системы:

1.  **База данных (PostgreSQL):**
    *   Таблица `epics`
    *   Таблица `user_stories`
    *   Таблица `acceptance_criteria`
    *   Таблица `requirements`

2.  **Бэкенд-приложение (Go):**
    *   Структуры моделей данных, связанные с указанными таблицами.
    *   Код репозиториев, отвечающий за взаимодействие с базой данных.
    *   Сервисный слой и бизнес-логика, где используется поле `LastModified`.
    *   Обработчики API (handlers) и объекты передачи данных (DTO), которые включают это поле.

3.  **API и документация:**
    *   Спецификация `docs/openapi-v3.yaml`.
    *   Спецификация `docs/swagger.yaml`.
    *   Все автоматически сгенерированные артефакты на их основе (например, `docs/generated/api-documentation.html`).

## 3. План работ

### 3.1. Миграция базы данных

1.  Создать новый файл миграции в директории `migrations/`.
2.  **Up-миграция:** Написать SQL-скрипт, который переименовывает колонку `last_modified` в `updated_at` для каждой из четырех затронутых таблиц.
    ```sql
    ALTER TABLE epics RENAME COLUMN last_modified TO updated_at;
    ALTER TABLE user_stories RENAME COLUMN last_modified TO updated_at;
    ALTER TABLE acceptance_criteria RENAME COLUMN last_modified TO updated_at;
    ALTER TABLE requirements RENAME COLUMN last_modified TO updated_at;
    ```
3.  **Down-миграция:** Написать SQL-скрипт для отката изменений, который переименовывает `updated_at` обратно в `last_modified`.
    ```sql
    ALTER TABLE epics RENAME COLUMN updated_at TO last_modified;
    ALTER TABLE user_stories RENAME COLUMN updated_at TO last_modified;
    ALTER TABLE acceptance_criteria RENAME COLUMN updated_at TO last_modified;
    ALTER TABLE requirements RENAME COLUMN updated_at TO last_modified;
    ```

### 3.2. Обновление кода приложения (Go)

1.  Провести глобальный поиск по всему проекту по ключевым словам `LastModified` и `last_modified`.
2.  Во всех структурах моделей Go, где есть поле `LastModified`, переименовать его в `UpdatedAt`.
3.  Обновить теги полей для сериализации в JSON и маппинга на базу данных. Пример:
    ```go
    // Было
    LastModified time.Time `json:"last_modified" db:"last_modified"`
    // Стало
    UpdatedAt time.Time `json:"updated_at" db:"updated_at"`
    ```
4.  Внести исправления во все участки кода (репозитории, сервисы, тесты), где компилятор укажет на ошибку из-за переименования поля.

### 3.3. Обновление API документации

1.  Внести изменения в файлы `docs/openapi-v3.yaml` и `docs/swagger.yaml`.
2.  Во всех схемах (schemas), где использовалось свойство `last_modified`, переименовать его в `updated_at`.
3.  Запустить скрипты для перегенерации документации, чтобы изменения отразились в HTML-версиях и других артефактах.

## 4. Критерии приемки

1.  Новая миграция базы данных успешно применяется (`up`) и откатывается (`down`).
2.  Весь проект успешно компилируется.
3.  Все существующие тесты (unit, integration, e2e) успешно проходят.
4.  При вызове `GET` эндпоинтов для затронутых сущностей (например, `/api/v1/epics/{id}`) в ответе присутствует поле `updated_at` с корректным значением.
5.  При обновлении сущностей через `PUT`/`PATCH` запросы значение в поле `updated_at` в базе данных обновляется.
6.  Обновленная API документация (Swagger/OpenAPI) развернута и точно соответствует фактической реализации API.

## 5. Риски и важные замечания

*   **Ломающее изменение (Breaking Change):** Переименование поля в API является ломающим изменением. Все клиенты, использующие текущую версию API, должны быть уведомлены. Необходимо спланировать выпуск новой мажорной версии API или обеспечить обратную совместимость на ограниченный период (не рекомендуется в данном случае).
*   **Большой объем рефакторинга:** Задача требует внесения изменений во множество файлов. Необходимо провести тщательное тестирование и код-ревью, чтобы убедиться, что ничего не упущено.
